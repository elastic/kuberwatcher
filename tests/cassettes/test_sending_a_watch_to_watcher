interactions:
- request:
    body: null
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: GET
    uri: http://127.0.0.1:9200/.watches/_search?size=1000
  response:
    body:
      string: '{"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no
        such index [.watches]","resource.type":"index_or_alias","resource.id":".watches","index_uuid":"_na_","index":".watches"}],"type":"index_not_found_exception","reason":"no
        such index [.watches]","resource.type":"index_or_alias","resource.id":".watches","index_uuid":"_na_","index":".watches"},"status":404}'
    headers:
      content-length:
      - '377'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 404
      message: Not Found
- request:
    body: null
    headers:
      Accept:
      - application/json
      Content-Type:
      - application/json
      User-Agent:
      - Swagger-Codegen/8.0.1/python
    method: GET
    uri: https://127.0.0.1:43641/api/v1/namespaces?labelSelector=watcher%3Denabled
  response:
    body:
      string: '{"kind":"NamespaceList","apiVersion":"v1","metadata":{"selfLink":"/api/v1/namespaces","resourceVersion":"798"},"items":[{"metadata":{"name":"override","selfLink":"/api/v1/namespaces/override","uid":"467be58b-aca9-11ea-bc6b-0242ac120002","resourceVersion":"317","creationTimestamp":"2020-06-12T12:36:02Z","labels":{"watcher":"enabled"},"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"v1\",\"kind\":\"Namespace\",\"metadata\":{\"annotations\":{\"watcher.alerts.slack\":\"@michael.override\"},\"labels\":{\"watcher\":\"enabled\"},\"name\":\"override\"}}\n","watcher.alerts.slack":"@michael.override"}},"spec":{"finalizers":["kubernetes"]},"status":{"phase":"Active"}},{"metadata":{"name":"test","selfLink":"/api/v1/namespaces/test","uid":"467c3b18-aca9-11ea-bc6b-0242ac120002","resourceVersion":"318","creationTimestamp":"2020-06-12T12:36:02Z","labels":{"watcher":"enabled"},"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"v1\",\"kind\":\"Namespace\",\"metadata\":{\"annotations\":{},\"labels\":{\"watcher\":\"enabled\"},\"name\":\"test\"}}\n"}},"spec":{"finalizers":["kubernetes"]},"status":{"phase":"Active"}}]}

'
    headers:
      Content-Length:
      - '1185'
      Content-Type:
      - application/json
      Date:
      - Fri, 12 Jun 2020 12:37:54 GMT
    status:
      code: 200
      message: OK
- request:
    body: null
    headers:
      Accept:
      - application/json
      Content-Type:
      - application/json
      User-Agent:
      - Swagger-Codegen/8.0.1/python
    method: GET
    uri: https://127.0.0.1:43641/api/v1/pods?labelSelector=watcher%21%3Ddisabled&watch=False
  response:
    body:
      string: '{"kind":"PodList","apiVersion":"v1","metadata":{"selfLink":"/api/v1/pods","resourceVersion":"798"},"items":[{"metadata":{"name":"disabled-56bdf5c8f6-ch2w9","generateName":"disabled-56bdf5c8f6-","namespace":"disabled","selfLink":"/api/v1/namespaces/disabled/pods/disabled-56bdf5c8f6-ch2w9","uid":"4871c8e7-aca9-11ea-bc6b-0242ac120002","resourceVersion":"726","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"pod-template-hash":"56bdf5c8f6","run":"disabled"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"disabled-56bdf5c8f6","uid":"486ee8e8-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"default-token-82mqh","secret":{"secretName":"default-token-82mqh","defaultMode":420}}],"containers":[{"name":"nginx","image":"nginx","resources":{},"volumeMounts":[{"name":"default-token-82mqh","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:20Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:20Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.3","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"nginx","state":{"running":{"startedAt":"2020-06-12T12:37:19Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.io/library/nginx:latest","imageID":"docker.io/library/nginx@sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133","containerID":"containerd://840ac8fa7efeca2de488a4825c04583562b9f57457af7d70a33f6b9fc2a2c03d"}],"qosClass":"BestEffort"}},{"metadata":{"name":"nginx-85b7896645-wx58p","generateName":"nginx-85b7896645-","namespace":"disabled","selfLink":"/api/v1/namespaces/disabled/pods/nginx-85b7896645-wx58p","uid":"4873142c-aca9-11ea-bc6b-0242ac120002","resourceVersion":"729","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"pod-template-hash":"85b7896645","run":"nginx","watcher":"enabled"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"nginx-85b7896645","uid":"486eeb57-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"default-token-82mqh","secret":{"secretName":"default-token-82mqh","defaultMode":420}}],"containers":[{"name":"nginx","image":"nginx","resources":{},"volumeMounts":[{"name":"default-token-82mqh","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:20Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:20Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.5","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"nginx","state":{"running":{"startedAt":"2020-06-12T12:37:20Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.io/library/nginx:latest","imageID":"docker.io/library/nginx@sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133","containerID":"containerd://67f9486759b324a04934ed3c9d02a41fd758240779068caeae4631cf75188028"}],"qosClass":"BestEffort"}},{"metadata":{"name":"coredns-fb8b8dccf-56lrk","generateName":"coredns-fb8b8dccf-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/coredns-fb8b8dccf-56lrk","uid":"48720340-aca9-11ea-bc6b-0242ac120002","resourceVersion":"794","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"k8s-app":"kube-dns","pod-template-hash":"fb8b8dccf"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"coredns-fb8b8dccf","uid":"486f0485-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"config-volume","configMap":{"name":"coredns","items":[{"key":"Corefile","path":"Corefile"}],"defaultMode":420}},{"name":"coredns-token-78drh","secret":{"secretName":"coredns-token-78drh","defaultMode":420}}],"containers":[{"name":"coredns","image":"k8s.gcr.io/coredns:1.3.1","args":["-conf","/etc/coredns/Corefile"],"ports":[{"name":"dns","containerPort":53,"protocol":"UDP"},{"name":"dns-tcp","containerPort":53,"protocol":"TCP"},{"name":"metrics","containerPort":9153,"protocol":"TCP"}],"resources":{"limits":{"memory":"170Mi"},"requests":{"cpu":"100m","memory":"70Mi"}},"volumeMounts":[{"name":"config-volume","readOnly":true,"mountPath":"/etc/coredns"},{"name":"coredns-token-78drh","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"livenessProbe":{"httpGet":{"path":"/health","port":8080,"scheme":"HTTP"},"initialDelaySeconds":60,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":5},"readinessProbe":{"httpGet":{"path":"/health","port":8080,"scheme":"HTTP"},"timeoutSeconds":1,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"capabilities":{"add":["NET_BIND_SERVICE"],"drop":["all"]},"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"Default","nodeSelector":{"beta.kubernetes.io/os":"linux"},"serviceAccountName":"coredns","serviceAccount":"coredns","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"CriticalAddonsOnly","operator":"Exists"},{"key":"node-role.kubernetes.io/master","effect":"NoSchedule"},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z"},{"type":"Ready","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:01Z","reason":"ContainersNotReady","message":"containers
        with unready status: [coredns]"},{"type":"ContainersReady","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:01Z","reason":"ContainersNotReady","message":"containers
        with unready status: [coredns]"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.7","startTime":"2020-06-12T12:36:47Z","containerStatuses":[{"name":"coredns","state":{"running":{"startedAt":"2020-06-12T12:37:49Z"}},"lastState":{"terminated":{"exitCode":1,"reason":"Error","startedAt":"2020-06-12T12:37:18Z","finishedAt":"2020-06-12T12:37:24Z","containerID":"containerd://25d61a604fa6129089db5d799419a723f6637cbb425eb060cfeb4dcaec1fdccf"}},"ready":false,"restartCount":3,"image":"k8s.gcr.io/coredns:1.3.1","imageID":"sha256:eb516548c180f8a6e0235034ccee2428027896af16a509786da13022fe95fe8c","containerID":"containerd://cdbed9b3192bd9ae110f63120d17e4f3ee495882eb652d8e5e3ca53e970d51e8"}],"qosClass":"Burstable"}},{"metadata":{"name":"coredns-fb8b8dccf-xzkfs","generateName":"coredns-fb8b8dccf-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/coredns-fb8b8dccf-xzkfs","uid":"48743b13-aca9-11ea-bc6b-0242ac120002","resourceVersion":"764","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"k8s-app":"kube-dns","pod-template-hash":"fb8b8dccf"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"coredns-fb8b8dccf","uid":"486f0485-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"config-volume","configMap":{"name":"coredns","items":[{"key":"Corefile","path":"Corefile"}],"defaultMode":420}},{"name":"coredns-token-78drh","secret":{"secretName":"coredns-token-78drh","defaultMode":420}}],"containers":[{"name":"coredns","image":"k8s.gcr.io/coredns:1.3.1","args":["-conf","/etc/coredns/Corefile"],"ports":[{"name":"dns","containerPort":53,"protocol":"UDP"},{"name":"dns-tcp","containerPort":53,"protocol":"TCP"},{"name":"metrics","containerPort":9153,"protocol":"TCP"}],"resources":{"limits":{"memory":"170Mi"},"requests":{"cpu":"100m","memory":"70Mi"}},"volumeMounts":[{"name":"config-volume","readOnly":true,"mountPath":"/etc/coredns"},{"name":"coredns-token-78drh","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"livenessProbe":{"httpGet":{"path":"/health","port":8080,"scheme":"HTTP"},"initialDelaySeconds":60,"timeoutSeconds":5,"periodSeconds":10,"successThreshold":1,"failureThreshold":5},"readinessProbe":{"httpGet":{"path":"/health","port":8080,"scheme":"HTTP"},"timeoutSeconds":1,"periodSeconds":10,"successThreshold":1,"failureThreshold":3},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"capabilities":{"add":["NET_BIND_SERVICE"],"drop":["all"]},"readOnlyRootFilesystem":true,"allowPrivilegeEscalation":false,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"Default","nodeSelector":{"beta.kubernetes.io/os":"linux"},"serviceAccountName":"coredns","serviceAccount":"coredns","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"CriticalAddonsOnly","operator":"Exists"},{"key":"node-role.kubernetes.io/master","effect":"NoSchedule"},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z"},{"type":"Ready","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z","reason":"ContainersNotReady","message":"containers
        with unready status: [coredns]"},{"type":"ContainersReady","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z","reason":"ContainersNotReady","message":"containers
        with unready status: [coredns]"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:47Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.6","startTime":"2020-06-12T12:36:47Z","containerStatuses":[{"name":"coredns","state":{"waiting":{"reason":"CrashLoopBackOff","message":"Back-off
        20s restarting failed container=coredns pod=coredns-fb8b8dccf-xzkfs_kube-system(48743b13-aca9-11ea-bc6b-0242ac120002)"}},"lastState":{"terminated":{"exitCode":1,"reason":"Error","startedAt":"2020-06-12T12:37:18Z","finishedAt":"2020-06-12T12:37:24Z","containerID":"containerd://636793d44219731e32bc711ba92dc9e16e180e194cbe6b7c2198b2158409fb7a"}},"ready":false,"restartCount":2,"image":"k8s.gcr.io/coredns:1.3.1","imageID":"sha256:eb516548c180f8a6e0235034ccee2428027896af16a509786da13022fe95fe8c","containerID":"containerd://636793d44219731e32bc711ba92dc9e16e180e194cbe6b7c2198b2158409fb7a"}],"qosClass":"Burstable"}},{"metadata":{"name":"etcd-kind-control-plane","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/etcd-kind-control-plane","uid":"6bdb0ff9-aca9-11ea-bc6b-0242ac120002","resourceVersion":"686","creationTimestamp":"2020-06-12T12:37:04Z","labels":{"component":"etcd","tier":"control-plane"},"annotations":{"kubernetes.io/config.hash":"725021e455091889fc493fa09331681c","kubernetes.io/config.mirror":"725021e455091889fc493fa09331681c","kubernetes.io/config.seen":"2020-06-12T12:35:41.724749451Z","kubernetes.io/config.source":"file"}},"spec":{"volumes":[{"name":"etcd-certs","hostPath":{"path":"/etc/kubernetes/pki/etcd","type":"DirectoryOrCreate"}},{"name":"etcd-data","hostPath":{"path":"/var/lib/etcd","type":"DirectoryOrCreate"}}],"containers":[{"name":"etcd","image":"k8s.gcr.io/etcd:3.3.10","command":["etcd","--advertise-client-urls=https://172.18.0.2:2379","--cert-file=/etc/kubernetes/pki/etcd/server.crt","--client-cert-auth=true","--data-dir=/var/lib/etcd","--initial-advertise-peer-urls=https://172.18.0.2:2380","--initial-cluster=kind-control-plane=https://172.18.0.2:2380","--key-file=/etc/kubernetes/pki/etcd/server.key","--listen-client-urls=https://127.0.0.1:2379,https://172.18.0.2:2379","--listen-peer-urls=https://172.18.0.2:2380","--name=kind-control-plane","--peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt","--peer-client-cert-auth=true","--peer-key-file=/etc/kubernetes/pki/etcd/peer.key","--peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt","--snapshot-count=10000","--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt"],"resources":{},"volumeMounts":[{"name":"etcd-data","mountPath":"/var/lib/etcd"},{"name":"etcd-certs","mountPath":"/etc/kubernetes/pki/etcd"}],"livenessProbe":{"exec":{"command":["/bin/sh","-ec","ETCDCTL_API=3
        etcdctl --endpoints=https://[127.0.0.1]:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt
        --cert=/etc/kubernetes/pki/etcd/healthcheck-client.crt --key=/etc/kubernetes/pki/etcd/healthcheck-client.key
        get foo"]},"initialDelaySeconds":15,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":8},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoExecute"}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:35:41Z","containerStatuses":[{"name":"etcd","state":{"running":{"startedAt":"2020-06-12T12:35:43Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/etcd:3.3.10","imageID":"sha256:2c4adeb21b4ff8ed3309d0e42b6b4ae39872399f7b37e0856e673b13c4aba13d","containerID":"containerd://1fdffb874d9cc8928dc2d2cc913a5fd86b300eae7dd677f0398db01fb91cea33"}],"qosClass":"BestEffort"}},{"metadata":{"name":"ip-masq-agent-fhrzb","generateName":"ip-masq-agent-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/ip-masq-agent-fhrzb","uid":"4848038f-aca9-11ea-bc6b-0242ac120002","resourceVersion":"466","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"app":"ip-masq-agent","controller-revision-hash":"699c8f6fcc","k8s-app":"ip-masq-agent","pod-template-generation":"1","tier":"node"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"ip-masq-agent","uid":"40813958-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"config","configMap":{"name":"ip-masq-agent","items":[{"key":"config","path":"ip-masq-agent"}],"defaultMode":420,"optional":true}},{"name":"ip-masq-agent-token-bqw9z","secret":{"secretName":"ip-masq-agent-token-bqw9z","defaultMode":420}}],"containers":[{"name":"ip-masq-agent","image":"k8s.gcr.io/ip-masq-agent:v2.4.1","resources":{},"volumeMounts":[{"name":"config","mountPath":"/etc/config"},{"name":"ip-masq-agent-token-bqw9z","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"capabilities":{"add":["NET_RAW","NET_ADMIN"]},"privileged":false,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"ip-masq-agent","serviceAccount":"ip-masq-agent","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchFields":[{"key":"metadata.name","operator":"In","values":["kind-control-plane"]}]}]}}},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/pid-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/network-unavailable","operator":"Exists","effect":"NoSchedule"}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:36:05Z","containerStatuses":[{"name":"ip-masq-agent","state":{"running":{"startedAt":"2020-06-12T12:36:05Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/ip-masq-agent:v2.4.1","imageID":"sha256:19bb968f77bba3a5b5f56b5c033d71f699c22bdc8bbe9412f0bfaf7f674a64cc","containerID":"containerd://f95831ffef2cfea525a79c7ce5bdc1245769a33fab7c17b88a5b624afd4fb742"}],"qosClass":"BestEffort"}},{"metadata":{"name":"kindnet-gh69t","generateName":"kindnet-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/kindnet-gh69t","uid":"484b898e-aca9-11ea-bc6b-0242ac120002","resourceVersion":"552","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"app":"kindnet","controller-revision-hash":"6744c84f84","k8s-app":"kindnet","pod-template-generation":"1","tier":"node"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"kindnet","uid":"407f8049-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"cni-cfg","hostPath":{"path":"/etc/cni/net.d","type":""}},{"name":"kindnet-token-mjch4","secret":{"secretName":"kindnet-token-mjch4","defaultMode":420}}],"containers":[{"name":"kindnet-cni","image":"kindest/kindnetd:0.1.0","env":[{"name":"HOST_IP","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"status.hostIP"}}},{"name":"POD_IP","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"status.podIP"}}},{"name":"CNI_CONFIG_TEMPLATE","valueFrom":{"configMapKeyRef":{"name":"kindnet-cfg","key":"cni-conf-template.json"}}}],"resources":{"limits":{"cpu":"100m","memory":"50Mi"},"requests":{"cpu":"100m","memory":"50Mi"}},"volumeMounts":[{"name":"cni-cfg","mountPath":"/etc/cni/net.d"},{"name":"kindnet-token-mjch4","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"capabilities":{"add":["NET_ADMIN"]},"privileged":false,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"kindnet","serviceAccount":"kindnet","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchFields":[{"key":"metadata.name","operator":"In","values":["kind-control-plane"]}]}]}}},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/pid-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/network-unavailable","operator":"Exists","effect":"NoSchedule"}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:37Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:37Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:36:05Z","containerStatuses":[{"name":"kindnet-cni","state":{"running":{"startedAt":"2020-06-12T12:36:37Z"}},"lastState":{"terminated":{"exitCode":2,"reason":"Error","startedAt":"2020-06-12T12:36:06Z","finishedAt":"2020-06-12T12:36:36Z","containerID":"containerd://232b4445e93c4aab4ee6d5c22ec8d6408a8ebee0fb30e7984c4e2a5dee532753"}},"ready":true,"restartCount":1,"image":"docker.io/kindest/kindnetd:0.1.0","imageID":"sha256:f227066bdc5f9aa2f8a9bb54854e5b7a23c6db8fce0f927e5c4feef8a9e74d46","containerID":"containerd://d225e96cfbb98eabbf3828fd324bee4ecf1740122390a830184e83ff41a22400"}],"qosClass":"Guaranteed"}},{"metadata":{"name":"kube-apiserver-kind-control-plane","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/kube-apiserver-kind-control-plane","uid":"64b43f74-aca9-11ea-bc6b-0242ac120002","resourceVersion":"656","creationTimestamp":"2020-06-12T12:36:52Z","labels":{"component":"kube-apiserver","tier":"control-plane"},"annotations":{"kubernetes.io/config.hash":"5bc93f3ba1ca86d98ac55d89f0227ded","kubernetes.io/config.mirror":"5bc93f3ba1ca86d98ac55d89f0227ded","kubernetes.io/config.seen":"2020-06-12T12:35:41.72475541Z","kubernetes.io/config.source":"file"}},"spec":{"volumes":[{"name":"ca-certs","hostPath":{"path":"/etc/ssl/certs","type":"DirectoryOrCreate"}},{"name":"etc-ca-certificates","hostPath":{"path":"/etc/ca-certificates","type":"DirectoryOrCreate"}},{"name":"k8s-certs","hostPath":{"path":"/etc/kubernetes/pki","type":"DirectoryOrCreate"}},{"name":"usr-local-share-ca-certificates","hostPath":{"path":"/usr/local/share/ca-certificates","type":"DirectoryOrCreate"}},{"name":"usr-share-ca-certificates","hostPath":{"path":"/usr/share/ca-certificates","type":"DirectoryOrCreate"}}],"containers":[{"name":"kube-apiserver","image":"k8s.gcr.io/kube-apiserver:v1.14.2","command":["kube-apiserver","--advertise-address=172.18.0.2","--allow-privileged=true","--authorization-mode=Node,RBAC","--client-ca-file=/etc/kubernetes/pki/ca.crt","--enable-admission-plugins=NodeRestriction","--enable-bootstrap-token-auth=true","--etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt","--etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt","--etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key","--etcd-servers=https://127.0.0.1:2379","--insecure-port=0","--kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt","--kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key","--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname","--proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt","--proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key","--requestheader-allowed-names=front-proxy-client","--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt","--requestheader-extra-headers-prefix=X-Remote-Extra-","--requestheader-group-headers=X-Remote-Group","--requestheader-username-headers=X-Remote-User","--secure-port=6443","--service-account-key-file=/etc/kubernetes/pki/sa.pub","--service-cluster-ip-range=10.96.0.0/12","--tls-cert-file=/etc/kubernetes/pki/apiserver.crt","--tls-private-key-file=/etc/kubernetes/pki/apiserver.key"],"resources":{"requests":{"cpu":"250m"}},"volumeMounts":[{"name":"ca-certs","readOnly":true,"mountPath":"/etc/ssl/certs"},{"name":"etc-ca-certificates","readOnly":true,"mountPath":"/etc/ca-certificates"},{"name":"k8s-certs","readOnly":true,"mountPath":"/etc/kubernetes/pki"},{"name":"usr-local-share-ca-certificates","readOnly":true,"mountPath":"/usr/local/share/ca-certificates"},{"name":"usr-share-ca-certificates","readOnly":true,"mountPath":"/usr/share/ca-certificates"}],"livenessProbe":{"httpGet":{"path":"/healthz","port":6443,"host":"172.18.0.2","scheme":"HTTPS"},"initialDelaySeconds":15,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":8},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoExecute"}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:35:41Z","containerStatuses":[{"name":"kube-apiserver","state":{"running":{"startedAt":"2020-06-12T12:35:43Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/kube-apiserver:v1.14.2","imageID":"sha256:e455634c173b0060e537f229155cbb1649d96945d8de54f3321eebd092d66a0c","containerID":"containerd://878315e26281c629b233c9313d9c7db359a34d45547dd2353d6da677a4965184"}],"qosClass":"Burstable"}},{"metadata":{"name":"kube-controller-manager-kind-control-plane","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/kube-controller-manager-kind-control-plane","uid":"68e0247f-aca9-11ea-bc6b-0242ac120002","resourceVersion":"657","creationTimestamp":"2020-06-12T12:36:59Z","labels":{"component":"kube-controller-manager","tier":"control-plane"},"annotations":{"kubernetes.io/config.hash":"f47cb1b0ae58afdec01ff0e513b03592","kubernetes.io/config.mirror":"f47cb1b0ae58afdec01ff0e513b03592","kubernetes.io/config.seen":"2020-06-12T12:35:41.724764475Z","kubernetes.io/config.source":"file"}},"spec":{"volumes":[{"name":"ca-certs","hostPath":{"path":"/etc/ssl/certs","type":"DirectoryOrCreate"}},{"name":"etc-ca-certificates","hostPath":{"path":"/etc/ca-certificates","type":"DirectoryOrCreate"}},{"name":"k8s-certs","hostPath":{"path":"/etc/kubernetes/pki","type":"DirectoryOrCreate"}},{"name":"kubeconfig","hostPath":{"path":"/etc/kubernetes/controller-manager.conf","type":"FileOrCreate"}},{"name":"usr-local-share-ca-certificates","hostPath":{"path":"/usr/local/share/ca-certificates","type":"DirectoryOrCreate"}},{"name":"usr-share-ca-certificates","hostPath":{"path":"/usr/share/ca-certificates","type":"DirectoryOrCreate"}}],"containers":[{"name":"kube-controller-manager","image":"k8s.gcr.io/kube-controller-manager:v1.14.2","command":["kube-controller-manager","--allocate-node-cidrs=true","--authentication-kubeconfig=/etc/kubernetes/controller-manager.conf","--authorization-kubeconfig=/etc/kubernetes/controller-manager.conf","--bind-address=127.0.0.1","--client-ca-file=/etc/kubernetes/pki/ca.crt","--cluster-cidr=10.244.0.0/16","--cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt","--cluster-signing-key-file=/etc/kubernetes/pki/ca.key","--controllers=*,bootstrapsigner,tokencleaner","--kubeconfig=/etc/kubernetes/controller-manager.conf","--leader-elect=true","--node-cidr-mask-size=24","--requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt","--root-ca-file=/etc/kubernetes/pki/ca.crt","--service-account-private-key-file=/etc/kubernetes/pki/sa.key","--use-service-account-credentials=true"],"resources":{"requests":{"cpu":"200m"}},"volumeMounts":[{"name":"ca-certs","readOnly":true,"mountPath":"/etc/ssl/certs"},{"name":"etc-ca-certificates","readOnly":true,"mountPath":"/etc/ca-certificates"},{"name":"k8s-certs","readOnly":true,"mountPath":"/etc/kubernetes/pki"},{"name":"kubeconfig","readOnly":true,"mountPath":"/etc/kubernetes/controller-manager.conf"},{"name":"usr-local-share-ca-certificates","readOnly":true,"mountPath":"/usr/local/share/ca-certificates"},{"name":"usr-share-ca-certificates","readOnly":true,"mountPath":"/usr/share/ca-certificates"}],"livenessProbe":{"httpGet":{"path":"/healthz","port":10252,"host":"127.0.0.1","scheme":"HTTP"},"initialDelaySeconds":15,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":8},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoExecute"}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:35:41Z","containerStatuses":[{"name":"kube-controller-manager","state":{"running":{"startedAt":"2020-06-12T12:35:43Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/kube-controller-manager:v1.14.2","imageID":"sha256:58f6abb9fb1b336348d3bb9dd80b5ecbc8dc963a3c1c20e778a0c20d3ed25344","containerID":"containerd://dbe2a45ce08fcd9e694e62214de24e910292ee81f42de7c65ac3e1a2afdc3218"}],"qosClass":"Burstable"}},{"metadata":{"name":"kube-proxy-nxkvr","generateName":"kube-proxy-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/kube-proxy-nxkvr","uid":"48478d6d-aca9-11ea-bc6b-0242ac120002","resourceVersion":"472","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"controller-revision-hash":"6c5f45759d","k8s-app":"kube-proxy","pod-template-generation":"1"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"kube-proxy","uid":"3fd82986-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"kube-proxy","configMap":{"name":"kube-proxy","defaultMode":420}},{"name":"xtables-lock","hostPath":{"path":"/run/xtables.lock","type":"FileOrCreate"}},{"name":"lib-modules","hostPath":{"path":"/lib/modules","type":""}},{"name":"kube-proxy-token-2qkjw","secret":{"secretName":"kube-proxy-token-2qkjw","defaultMode":420}}],"containers":[{"name":"kube-proxy","image":"k8s.gcr.io/kube-proxy:v1.14.2","command":["/usr/local/bin/kube-proxy","--config=/var/lib/kube-proxy/config.conf","--hostname-override=$(NODE_NAME)"],"env":[{"name":"NODE_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.nodeName"}}}],"resources":{},"volumeMounts":[{"name":"kube-proxy","mountPath":"/var/lib/kube-proxy"},{"name":"xtables-lock","mountPath":"/run/xtables.lock"},{"name":"lib-modules","readOnly":true,"mountPath":"/lib/modules"},{"name":"kube-proxy-token-2qkjw","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"kube-proxy","serviceAccount":"kube-proxy","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchFields":[{"key":"metadata.name","operator":"In","values":["kind-control-plane"]}]}]}}},"schedulerName":"default-scheduler","tolerations":[{"key":"CriticalAddonsOnly","operator":"Exists"},{"operator":"Exists"},{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/pid-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/network-unavailable","operator":"Exists","effect":"NoSchedule"}],"priorityClassName":"system-node-critical","priority":2000001000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:06Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:06Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:05Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:36:05Z","containerStatuses":[{"name":"kube-proxy","state":{"running":{"startedAt":"2020-06-12T12:36:05Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/kube-proxy:v1.14.2","imageID":"sha256:7387c4b88e2df50ccca4f6f8167992605cfe50d0075a647b5ab5187378ac2bd8","containerID":"containerd://5f26f600ffcb0624418e97a8b87c03d84e7638df41254b65c3002534c585a4d6"}],"qosClass":"BestEffort"}},{"metadata":{"name":"kube-scheduler-kind-control-plane","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/kube-scheduler-kind-control-plane","uid":"65e56048-aca9-11ea-bc6b-0242ac120002","resourceVersion":"658","creationTimestamp":"2020-06-12T12:36:54Z","labels":{"component":"kube-scheduler","tier":"control-plane"},"annotations":{"kubernetes.io/config.hash":"9b290132363a92652555896288ca3f88","kubernetes.io/config.mirror":"9b290132363a92652555896288ca3f88","kubernetes.io/config.seen":"2020-06-12T12:35:41.724766069Z","kubernetes.io/config.source":"file"}},"spec":{"volumes":[{"name":"kubeconfig","hostPath":{"path":"/etc/kubernetes/scheduler.conf","type":"FileOrCreate"}}],"containers":[{"name":"kube-scheduler","image":"k8s.gcr.io/kube-scheduler:v1.14.2","command":["kube-scheduler","--bind-address=127.0.0.1","--kubeconfig=/etc/kubernetes/scheduler.conf","--leader-elect=true"],"resources":{"requests":{"cpu":"100m"}},"volumeMounts":[{"name":"kubeconfig","readOnly":true,"mountPath":"/etc/kubernetes/scheduler.conf"}],"livenessProbe":{"httpGet":{"path":"/healthz","port":10251,"host":"127.0.0.1","scheme":"HTTP"},"initialDelaySeconds":15,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":8},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoExecute"}],"priorityClassName":"system-cluster-critical","priority":2000000000,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:43Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:35:41Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:35:41Z","containerStatuses":[{"name":"kube-scheduler","state":{"running":{"startedAt":"2020-06-12T12:35:43Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"k8s.gcr.io/kube-scheduler:v1.14.2","imageID":"sha256:1c93cc1335f8df0a96db1a773bb2851920fb574e1c9386f3960674279d5b978b","containerID":"containerd://d22ff212936d9e7e40da0ae92538769b9bdd00153bccdfb200abf18559c1e89b"}],"qosClass":"Burstable"}},{"metadata":{"name":"metricbeat-558b6cb866-vz48z","generateName":"metricbeat-558b6cb866-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/metricbeat-558b6cb866-vz48z","uid":"4b8eab56-aca9-11ea-bc6b-0242ac120002","resourceVersion":"688","creationTimestamp":"2020-06-12T12:36:10Z","labels":{"k8s-app":"metricbeat","pod-template-hash":"558b6cb866"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"metricbeat-558b6cb866","uid":"4b88d31e-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"config","configMap":{"name":"metricbeat-deployment-config","defaultMode":384}},{"name":"modules","configMap":{"name":"metricbeat-deployment-modules","defaultMode":384}},{"name":"metricbeat-token-wngk4","secret":{"secretName":"metricbeat-token-wngk4","defaultMode":420}}],"containers":[{"name":"metricbeat","image":"docker.elastic.co/beats/metricbeat:7.1.0","args":["-c","/etc/metricbeat.yml","-e"],"env":[{"name":"ELASTICSEARCH_HOST","value":"elasticsearch"},{"name":"ELASTICSEARCH_PORT","value":"9200"},{"name":"ELASTICSEARCH_USERNAME","value":"elastic"},{"name":"ELASTICSEARCH_PASSWORD","value":"changeme"},{"name":"ELASTIC_CLOUD_ID"},{"name":"ELASTIC_CLOUD_AUTH"},{"name":"NODE_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.nodeName"}}}],"resources":{"limits":{"memory":"200Mi"},"requests":{"cpu":"100m","memory":"100Mi"}},"volumeMounts":[{"name":"config","readOnly":true,"mountPath":"/etc/metricbeat.yml","subPath":"metricbeat.yml"},{"name":"modules","readOnly":true,"mountPath":"/usr/share/metricbeat/modules.d"},{"name":"metricbeat-token-wngk4","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"runAsUser":0,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirstWithHostNet","serviceAccountName":"metricbeat","serviceAccount":"metricbeat","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:12Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:12Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"metricbeat","state":{"running":{"startedAt":"2020-06-12T12:37:11Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.elastic.co/beats/metricbeat:7.1.0","imageID":"docker.elastic.co/beats/metricbeat@sha256:2585c2461560104bbf72ca6be6534b5711e7f87a7f2b230fb103870ec46c03ed","containerID":"containerd://16654f4f3d199430702a96606ac8471f7c393138f780fc7d5f57e9f3d51f991d"}],"qosClass":"Burstable"}},{"metadata":{"name":"metricbeat-s5skq","generateName":"metricbeat-","namespace":"kube-system","selfLink":"/api/v1/namespaces/kube-system/pods/metricbeat-s5skq","uid":"60a3e2f6-aca9-11ea-bc6b-0242ac120002","resourceVersion":"735","creationTimestamp":"2020-06-12T12:36:45Z","labels":{"controller-revision-hash":"5db8bb84b6","k8s-app":"metricbeat","pod-template-generation":"1"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"DaemonSet","name":"metricbeat","uid":"4b83ca2c-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"proc","hostPath":{"path":"/proc","type":""}},{"name":"cgroup","hostPath":{"path":"/sys/fs/cgroup","type":""}},{"name":"dockersock","hostPath":{"path":"/var/run/docker.sock","type":""}},{"name":"config","configMap":{"name":"metricbeat-daemonset-config","defaultMode":384}},{"name":"modules","configMap":{"name":"metricbeat-daemonset-modules","defaultMode":384}},{"name":"data","hostPath":{"path":"/var/lib/metricbeat-data","type":"DirectoryOrCreate"}},{"name":"metricbeat-token-wngk4","secret":{"secretName":"metricbeat-token-wngk4","defaultMode":420}}],"containers":[{"name":"metricbeat","image":"docker.elastic.co/beats/metricbeat:7.1.0","args":["-c","/etc/metricbeat.yml","-e","-system.hostfs=/hostfs"],"env":[{"name":"ELASTICSEARCH_HOST","value":"elasticsearch"},{"name":"ELASTICSEARCH_PORT","value":"9200"},{"name":"ELASTICSEARCH_USERNAME","value":"elastic"},{"name":"ELASTICSEARCH_PASSWORD","value":"changeme"},{"name":"ELASTIC_CLOUD_ID"},{"name":"ELASTIC_CLOUD_AUTH"},{"name":"NODE_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.nodeName"}}}],"resources":{"limits":{"memory":"200Mi"},"requests":{"cpu":"100m","memory":"100Mi"}},"volumeMounts":[{"name":"config","readOnly":true,"mountPath":"/etc/metricbeat.yml","subPath":"metricbeat.yml"},{"name":"modules","readOnly":true,"mountPath":"/usr/share/metricbeat/modules.d"},{"name":"dockersock","mountPath":"/var/run/docker.sock"},{"name":"proc","readOnly":true,"mountPath":"/hostfs/proc"},{"name":"cgroup","readOnly":true,"mountPath":"/hostfs/sys/fs/cgroup"},{"name":"metricbeat-token-wngk4","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent","securityContext":{"runAsUser":0,"procMount":"Default"}}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirstWithHostNet","serviceAccountName":"metricbeat","serviceAccount":"metricbeat","nodeName":"kind-control-plane","hostNetwork":true,"securityContext":{},"affinity":{"nodeAffinity":{"requiredDuringSchedulingIgnoredDuringExecution":{"nodeSelectorTerms":[{"matchFields":[{"key":"metadata.name","operator":"In","values":["kind-control-plane"]}]}]}}},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute"},{"key":"node.kubernetes.io/disk-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/memory-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/pid-pressure","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/unschedulable","operator":"Exists","effect":"NoSchedule"},{"key":"node.kubernetes.io/network-unavailable","operator":"Exists","effect":"NoSchedule"}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:21Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:21Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"172.18.0.2","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"metricbeat","state":{"running":{"startedAt":"2020-06-12T12:37:20Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.elastic.co/beats/metricbeat:7.1.0","imageID":"docker.elastic.co/beats/metricbeat@sha256:2585c2461560104bbf72ca6be6534b5711e7f87a7f2b230fb103870ec46c03ed","containerID":"containerd://6544d4208208babc9ed0f1184d8a2b88bcc6585c8cfd8b6c342692d35853dab5"}],"qosClass":"Burstable"}},{"metadata":{"name":"hello-1591965420-t5q9z","generateName":"hello-1591965420-","namespace":"test","selfLink":"/api/v1/namespaces/test/pods/hello-1591965420-t5q9z","uid":"6944fb4e-aca9-11ea-bc6b-0242ac120002","resourceVersion":"742","creationTimestamp":"2020-06-12T12:37:00Z","labels":{"controller-uid":"694427f5-aca9-11ea-bc6b-0242ac120002","job-name":"hello-1591965420"},"ownerReferences":[{"apiVersion":"batch/v1","kind":"Job","name":"hello-1591965420","uid":"694427f5-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"default-token-h998p","secret":{"secretName":"default-token-h998p","defaultMode":420}}],"containers":[{"name":"hello","image":"hello-world","resources":{},"volumeMounts":[{"name":"default-token-h998p","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"OnFailure","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Succeeded","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:00Z","reason":"PodCompleted"},{"type":"Ready","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:00Z","reason":"PodCompleted"},{"type":"ContainersReady","status":"False","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:00Z","reason":"PodCompleted"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:00Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.8","startTime":"2020-06-12T12:37:00Z","containerStatuses":[{"name":"hello","state":{"terminated":{"exitCode":0,"reason":"Completed","startedAt":"2020-06-12T12:37:21Z","finishedAt":"2020-06-12T12:37:21Z","containerID":"containerd://f1a9bbf75f5c9cbda98d1ca9873914f3ed65c8a34df2d2100e1a6e286384961a"}},"lastState":{},"ready":false,"restartCount":0,"image":"docker.io/library/hello-world:latest","imageID":"docker.io/library/hello-world@sha256:d58e752213a51785838f9eed2b7a498ffa1cb3aa7f946dda11af39286c3db9a9","containerID":"containerd://f1a9bbf75f5c9cbda98d1ca9873914f3ed65c8a34df2d2100e1a6e286384961a"}],"qosClass":"BestEffort"}},{"metadata":{"name":"nginx-7db9fccd9b-kvjwv","generateName":"nginx-7db9fccd9b-","namespace":"test","selfLink":"/api/v1/namespaces/test/pods/nginx-7db9fccd9b-kvjwv","uid":"487173c0-aca9-11ea-bc6b-0242ac120002","resourceVersion":"711","creationTimestamp":"2020-06-12T12:36:05Z","labels":{"pod-template-hash":"7db9fccd9b","run":"nginx"},"ownerReferences":[{"apiVersion":"apps/v1","kind":"ReplicaSet","name":"nginx-7db9fccd9b","uid":"486ef229-aca9-11ea-bc6b-0242ac120002","controller":true,"blockOwnerDeletion":true}]},"spec":{"volumes":[{"name":"default-token-h998p","secret":{"secretName":"default-token-h998p","defaultMode":420}}],"containers":[{"name":"nginx","image":"nginx","resources":{},"volumeMounts":[{"name":"default-token-h998p","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:19Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:19Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.4","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"nginx","state":{"running":{"startedAt":"2020-06-12T12:37:18Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.io/library/nginx:latest","imageID":"docker.io/library/nginx@sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133","containerID":"containerd://f68fca5b7b9c31fc3c689e144a86a5bdd4e01068138cb2e11538a9e6c927e0aa"}],"qosClass":"BestEffort"}},{"metadata":{"name":"nginx-pod","namespace":"test","selfLink":"/api/v1/namespaces/test/pods/nginx-pod","uid":"4ac10eb6-aca9-11ea-bc6b-0242ac120002","resourceVersion":"714","creationTimestamp":"2020-06-12T12:36:09Z","annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"name\":\"nginx-pod\",\"namespace\":\"test\"},\"spec\":{\"containers\":[{\"image\":\"nginx\",\"name\":\"nginx\"}]}}\n"}},"spec":{"volumes":[{"name":"default-token-h998p","secret":{"secretName":"default-token-h998p","defaultMode":420}}],"containers":[{"name":"nginx","image":"nginx","resources":{},"volumeMounts":[{"name":"default-token-h998p","readOnly":true,"mountPath":"/var/run/secrets/kubernetes.io/serviceaccount"}],"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","serviceAccountName":"default","serviceAccount":"default","nodeName":"kind-control-plane","securityContext":{},"schedulerName":"default-scheduler","tolerations":[{"key":"node.kubernetes.io/not-ready","operator":"Exists","effect":"NoExecute","tolerationSeconds":300},{"key":"node.kubernetes.io/unreachable","operator":"Exists","effect":"NoExecute","tolerationSeconds":300}],"priority":0,"enableServiceLinks":true},"status":{"phase":"Running","conditions":[{"type":"Initialized","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"},{"type":"Ready","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:19Z"},{"type":"ContainersReady","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:37:19Z"},{"type":"PodScheduled","status":"True","lastProbeTime":null,"lastTransitionTime":"2020-06-12T12:36:45Z"}],"hostIP":"172.18.0.2","podIP":"10.244.0.2","startTime":"2020-06-12T12:36:45Z","containerStatuses":[{"name":"nginx","state":{"running":{"startedAt":"2020-06-12T12:37:18Z"}},"lastState":{},"ready":true,"restartCount":0,"image":"docker.io/library/nginx:latest","imageID":"docker.io/library/nginx@sha256:21f32f6c08406306d822a0e6e8b7dc81f53f336570e852e25fbe1e3e3d0d0133","containerID":"containerd://07f7abba023137bb8e9980d92118248cafb52372a255064b1d0e64097384a67f"}],"qosClass":"BestEffort"}}]}

'
    headers:
      Content-Type:
      - application/json
      Date:
      - Fri, 12 Jun 2020 12:37:54 GMT
    status:
      code: 200
      message: OK
- request:
    body: '{"metadata":{"name":"disabled.nginx","namespace":"disabled","regex":"nginx-%5B%5E-%5D%2B-%5B%5E-%5D%2B","kibana_url":"https://kibana.example.com","kibana_dashboard":"","docs":"","xpack":{"type":"json"},"window":"300s"},"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.ready":"true"}}],"must":[{"regexp":{"kubernetes.pod.name":"nginx-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"disabled"}},{"match":{"metricset.name":"state_pod"}},{"match":{"kubernetes.pod.status.phase":"running"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.aggregations.not_ready.buckets":{"not_eq":[]}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
      href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
      <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"},"to":["kuberwatcher-alerts@example.com"]}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
      has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
      <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}","to":["@michael.russell"]}}}}}'
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: PUT
    uri: http://127.0.0.1:9200/_xpack/watcher/watch/disabled.nginx
  response:
    body:
      string: '{"_id":"disabled.nginx","_version":1,"_seq_no":0,"_primary_term":1,"created":true}'
    headers:
      Warning:
      - 299 Elasticsearch-7.1.1-7a013de "[PUT /_xpack/watcher/watch/{id}] is deprecated!
        Use [PUT /_watcher/watch/{id}] instead."
      content-length:
      - '82'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 201
      message: Created
- request:
    body: '{"metadata":{"name":"test.nginx","namespace":"test","regex":"nginx-%5B%5E-%5D%2B-%5B%5E-%5D%2B","kibana_url":"https://kibana.example.com","kibana_dashboard":"","docs":"","xpack":{"type":"json"},"window":"300s"},"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.ready":"true"}}],"must":[{"regexp":{"kubernetes.pod.name":"nginx-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"test"}},{"match":{"metricset.name":"state_pod"}},{"match":{"kubernetes.pod.status.phase":"running"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.aggregations.not_ready.buckets":{"not_eq":[]}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
      href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
      <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"},"to":["kuberwatcher-alerts@example.com"]}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
      has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
      <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}","to":["@michael.russell"]}}}}}'
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: PUT
    uri: http://127.0.0.1:9200/_xpack/watcher/watch/test.nginx
  response:
    body:
      string: '{"_id":"test.nginx","_version":1,"_seq_no":1,"_primary_term":1,"created":true}'
    headers:
      Warning:
      - 299 Elasticsearch-7.1.1-7a013de "[PUT /_xpack/watcher/watch/{id}] is deprecated!
        Use [PUT /_watcher/watch/{id}] instead."
      content-length:
      - '78'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 201
      message: Created
- request:
    body: '{"metadata":{"name":"test.hello","namespace":"test","regex":"hello-%5B%5E-%5D%2B-%5B%5E-%5D%2B","kibana_url":"https://kibana.example.com","kibana_dashboard":"","docs":"","xpack":{"type":"json"},"window":"300s"},"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.phase":"running"}},{"match":{"kubernetes.pod.status.phase":"pending"}}],"must":[{"regexp":{"kubernetes.pod.name":"hello-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"test"}},{"match":{"metricset.name":"state_pod"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}},"size":2,"sort":[{"kubernetes.pod.name":{"order":"desc","mode":"max"}}]}}}},"condition":{"script":{"lang":"painless","source":"for
      (h in ctx.payload.hits.hits) { if (h._source.kubernetes.pod.status.phase ==
      ''succeeded'') return false; } return true;"}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
      href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
      has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
      <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"},"to":["kuberwatcher-alerts@example.com"]}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
      has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
      <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}","to":["@michael.russell"]}}}}}'
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: PUT
    uri: http://127.0.0.1:9200/_xpack/watcher/watch/test.hello
  response:
    body:
      string: '{"_id":"test.hello","_version":1,"_seq_no":2,"_primary_term":1,"created":true}'
    headers:
      Warning:
      - 299 Elasticsearch-7.1.1-7a013de "[PUT /_xpack/watcher/watch/{id}] is deprecated!
        Use [PUT /_watcher/watch/{id}] instead."
      content-length:
      - '78'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 201
      message: Created
- request:
    body: '{"metadata":{"window":"300s","subject":"No metricbeat data has been recieved
      in the last 5 minutes!","message":"No metricbeat data has been recieved in the
      last 5 minutes! <https://kibana.example.com|kibana>"},"trigger":{"schedule":{"interval":"60s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"query":{"bool":{"must":[{"match":{"metricset.name":"state_pod"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.hits.total":{"eq":0}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","subject":"{{ctx.metadata.subject}}","body":{"text":"{{ctx.metadata.message}}"},"to":["kuberwatcher-alerts@example.com"]}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"text":"{{ctx.metadata.message}}","to":["@michael.russell"]}}}}}'
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: PUT
    uri: http://127.0.0.1:9200/_xpack/watcher/watch/metricbeat
  response:
    body:
      string: '{"_id":"metricbeat","_version":1,"_seq_no":3,"_primary_term":1,"created":true}'
    headers:
      Warning:
      - 299 Elasticsearch-7.1.1-7a013de "[PUT /_xpack/watcher/watch/{id}] is deprecated!
        Use [PUT /_watcher/watch/{id}] instead."
      content-length:
      - '78'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 201
      message: Created
- request:
    body: null
    headers:
      connection:
      - keep-alive
      content-type:
      - application/json
    method: GET
    uri: http://127.0.0.1:9200/.watches/_search?size=1000
  response:
    body:
      string: '{"took":2,"timed_out":false,"_shards":{"total":1,"successful":1,"skipped":0,"failed":0},"hits":{"total":{"value":4,"relation":"eq"},"max_score":1.0,"hits":[{"_index":".watches","_type":"_doc","_id":"disabled.nginx","_score":1.0,"_source":{"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.ready":"true"}}],"must":[{"regexp":{"kubernetes.pod.name":"nginx-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"disabled"}},{"match":{"metricset.name":"state_pod"}},{"match":{"kubernetes.pod.status.phase":"running"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.aggregations.not_ready.buckets":{"not_eq":[]}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","to":["kuberwatcher-alerts@example.com"],"subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
        href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
        <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"to":["@michael.russell"],"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
        has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
        <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}}},"metadata":{"regex":"nginx-%5B%5E-%5D%2B-%5B%5E-%5D%2B","docs":"","name":"disabled.nginx","namespace":"disabled","window":"300s","kibana_url":"https://kibana.example.com","kibana_dashboard":"","xpack":{"type":"json"}},"status":{"state":{"active":true,"timestamp":"2020-06-12T12:37:54.236Z"},"actions":{"email_admin":{"ack":{"timestamp":"2020-06-12T12:37:54.236Z","state":"awaits_successful_execution"}},"notify-slack":{"ack":{"timestamp":"2020-06-12T12:37:54.236Z","state":"awaits_successful_execution"}}},"headers":{"_xpack_security_authentication":"l++rAwAHZWxhc3RpYwEJc3VwZXJ1c2VyCgEJX3Jlc2VydmVkBQEAAAEADDQ2ZDA0YmNiMzhlYghyZXNlcnZlZAhyZXNlcnZlZAAACgA="},"version":-1}}},{"_index":".watches","_type":"_doc","_id":"test.nginx","_score":1.0,"_source":{"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.ready":"true"}}],"must":[{"regexp":{"kubernetes.pod.name":"nginx-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"test"}},{"match":{"metricset.name":"state_pod"}},{"match":{"kubernetes.pod.status.phase":"running"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.aggregations.not_ready.buckets":{"not_eq":[]}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","to":["kuberwatcher-alerts@example.com"],"subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
        href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
        <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"to":["@michael.russell"],"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
        has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
        <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}}},"metadata":{"regex":"nginx-%5B%5E-%5D%2B-%5B%5E-%5D%2B","docs":"","name":"test.nginx","namespace":"test","window":"300s","kibana_url":"https://kibana.example.com","kibana_dashboard":"","xpack":{"type":"json"}},"status":{"state":{"active":true,"timestamp":"2020-06-12T12:37:54.476Z"},"actions":{"email_admin":{"ack":{"timestamp":"2020-06-12T12:37:54.476Z","state":"awaits_successful_execution"}},"notify-slack":{"ack":{"timestamp":"2020-06-12T12:37:54.476Z","state":"awaits_successful_execution"}}},"headers":{"_xpack_security_authentication":"l++rAwAHZWxhc3RpYwEJc3VwZXJ1c2VyCgEJX3Jlc2VydmVkBQEAAAEADDQ2ZDA0YmNiMzhlYghyZXNlcnZlZAhyZXNlcnZlZAAACgA="},"version":-1}}},{"_index":".watches","_type":"_doc","_id":"test.hello","_score":1.0,"_source":{"trigger":{"schedule":{"interval":"30s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"aggs":{"result":{"top_hits":{"size":1}},"pods":{"cardinality":{"field":"kubernetes.pod.name"}},"not_ready":{"terms":{"field":"kubernetes.pod.name","min_doc_count":12,"size":100}}},"query":{"bool":{"must_not":[{"match":{"kubernetes.pod.status.phase":"running"}},{"match":{"kubernetes.pod.status.phase":"pending"}}],"must":[{"regexp":{"kubernetes.pod.name":"hello-[^-]+-[^-]+"}},{"match":{"kubernetes.namespace":"test"}},{"match":{"metricset.name":"state_pod"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}},"size":2,"sort":[{"kubernetes.pod.name":{"order":"desc","mode":"max"}}]}}}},"condition":{"script":{"source":"for
        (h in ctx.payload.hits.hits) { if (h._source.kubernetes.pod.status.phase ==
        ''succeeded'') return false; } return true;","lang":"painless"}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","to":["kuberwatcher-alerts@example.com"],"subject":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}{{ctx.metadata.name}}
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s){{/ctx.payload.aggregations.result.hits.hits.0._source}}","body":{"html":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}<a
        href=\"{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))\">{{ctx.metadata.name}}</a>
        has {{ctx.payload.aggregations.pods.value}} not ready pod(s) <a href=\"{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status\">[ack]</a>{{#ctx.metadata.docs}}
        <a href=\"{{.}}\">[docs]</a>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"to":["@michael.russell"],"text":"{{#ctx.payload.aggregations.result.hits.hits.0._source}}*<{{ctx.metadata.kibana_url}}/app/kibana#/discover?_a=(columns:!(_source),filters:!((''$state'':(store:appState),meta:(alias:!n,disabled:!f,index:''metricbeat-*'',key:query,negate:!f,type:custom,value:''''),query:(bool:(must:!((regexp:(kubernetes.pod.name:''{{ctx.metadata.regex}}'')),(match:(metricset.name:''state_pod'')),(match:(kubernetes.namespace:{{ctx.metadata.namespace}}))))))),index:''metricbeat-*'',interval:auto,query:(language:lucene,query:''''),regexp:(language:lucene,query:''kubernetes.pod.name:test-nginx-%5B%5E-%5D%20-%5B%5E-%5D%20''),sort:!(''@timestamp'',desc),time:(from:now%2FM,mode:quick,to:now%2FM))&_g=(refreshInterval:(display:Off,pause:!f,value:0),time:(from:now-15m,mode:quick,to:now))|{{ctx.metadata.name}}>*
        has `{{ctx.payload.aggregations.pods.value}}` not ready pod(s) <{{ctx.metadata.kibana_url}}/app/management/insightsAndAlerting/watcher/watches/watch/{{ctx.metadata.name}}/status|[ack]>{{#ctx.metadata.docs}}
        <{{.}}|[docs]>{{/ctx.metadata.docs}}{{/ctx.payload.aggregations.result.hits.hits.0._source}}"}}}},"metadata":{"regex":"hello-%5B%5E-%5D%2B-%5B%5E-%5D%2B","docs":"","name":"test.hello","namespace":"test","window":"300s","kibana_url":"https://kibana.example.com","kibana_dashboard":"","xpack":{"type":"json"}},"status":{"state":{"active":true,"timestamp":"2020-06-12T12:37:54.501Z"},"actions":{"email_admin":{"ack":{"timestamp":"2020-06-12T12:37:54.501Z","state":"awaits_successful_execution"}},"notify-slack":{"ack":{"timestamp":"2020-06-12T12:37:54.501Z","state":"awaits_successful_execution"}}},"headers":{"_xpack_security_authentication":"l++rAwAHZWxhc3RpYwEJc3VwZXJ1c2VyCgEJX3Jlc2VydmVkBQEAAAEADDQ2ZDA0YmNiMzhlYghyZXNlcnZlZAhyZXNlcnZlZAAACgA="},"version":-1}}},{"_index":".watches","_type":"_doc","_id":"metricbeat","_score":1.0,"_source":{"trigger":{"schedule":{"interval":"60s"}},"input":{"search":{"request":{"search_type":"query_then_fetch","indices":["metricbeat-*"],"rest_total_hits_as_int":true,"body":{"query":{"bool":{"must":[{"match":{"metricset.name":"state_pod"}}],"filter":[{"range":{"@timestamp":{"gte":"now-{{ctx.metadata.window}}"}}}]}}}}}},"condition":{"compare":{"ctx.payload.hits.total":{"eq":0}}},"actions":{"email_admin":{"throttle_period_in_millis":3600000,"email":{"profile":"standard","to":["kuberwatcher-alerts@example.com"],"subject":"{{ctx.metadata.subject}}","body":{"text":"{{ctx.metadata.message}}"}}},"notify-slack":{"throttle_period_in_millis":3600000,"slack":{"message":{"to":["@michael.russell"],"text":"{{ctx.metadata.message}}"}}}},"metadata":{"subject":"No
        metricbeat data has been recieved in the last 5 minutes!","window":"300s","message":"No
        metricbeat data has been recieved in the last 5 minutes! <https://kibana.example.com|kibana>"},"status":{"state":{"active":true,"timestamp":"2020-06-12T12:37:54.542Z"},"actions":{"email_admin":{"ack":{"timestamp":"2020-06-12T12:37:54.542Z","state":"awaits_successful_execution"}},"notify-slack":{"ack":{"timestamp":"2020-06-12T12:37:54.542Z","state":"awaits_successful_execution"}}},"headers":{"_xpack_security_authentication":"l++rAwAHZWxhc3RpYwEJc3VwZXJ1c2VyCgEJX3Jlc2VydmVkBQEAAAEADDQ2ZDA0YmNiMzhlYghyZXNlcnZlZAhyZXNlcnZlZAAACgA="},"version":-1}}}]}}'
    headers:
      content-length:
      - '14404'
      content-type:
      - application/json; charset=UTF-8
    status:
      code: 200
      message: OK
version: 1
